---
title: 'EcoAnimal USP, Prática: Reprodução'
author: "Marco A. R. Mello"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
editor_options:
  markdown:
    wrap: 72
---

Clique no triângulo colorido dentro da caixa de código abaixo:

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::knit_hooks$set(inline = function(x) {
prettyNum(x, big.mark=",")
})
```

Para entender o contexto deste tutorial e creditar seus autores, leia o
[README](https://github.com/marmello77/EcoAnimal/blob/main/README.md).

## Atenção!

Siga à risca as instruções dadas a seguir. Qualquer desvio delas pode
acarretar em problemas técnicos que nos farão perder tempo em sala
desnecessariamente. Faça a prática com atenção e sem pressa.

1.  Mude o modo de visualização aqui no RStudio para `Visual`, clicando
    no botão que fica no canto esquerdo da barra de formatação da aba
    deste arquivo;

2.  Clique no triângulo colorido da primeira caixa de código (no alto à
    direita), logo acima desta seção;

3.  Leia atentamente este roteiro e faça a prática seguindo as
    orientações da equipe docente;

4.  Toda vez que for responder perguntas usando as caixas de texto deste
    tutorial, salve cópias de seguraça em um editor de texto externo,
    por via das dúvidas;

5.  O relatório deve ser entregue através da tarefa criada no moodle da
    disciplina. Não serão aceitos relatórios entregues fora do prazo.

## Cabeçalho

Escreva na caixa de texto abaixo os nomes completos dos integrantes do
seu grupo, junto com seus respectivos NUSP. Inclua também a data da
prática.

```{=html}
<style>
.answer-box {
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
```

::: answer-box
Nomes + NUSP:

Data:
:::

## **Objetivo**

Nesta prática, interpretaremos mais a fundo o artigo de base,
aprenderemos um pouco mais sobre o método científico e treinaremos
algumas habilidades básicas em ciência de dados.

## Artigo de base

Matsumura et al. ([2020,
BiolLett](https://doi.org/10.1098/rsbl.2020.0601)).

## **Passos iniciais**

1.  Discuta os pontos principais do artigo de base com a turma e os
    docentes em sala;

2.  Responda as questões apresentadas neste tutorial.

3.  Verifique e instale os pacotes necessários:

```{r}
if(!require(ggplot2)){
  install.packages("ggplot2")
  library(ggplot2)
}

if(!require(readxl)){
  install.packages("readxl")
  library(readxl)
}

if(!require(rstudioapi)){
  install.packages("rstudioapi")
  library(rstudioapi)
}
```

## Elementos argumentativos

1.  Identifique no texto os seguintes *elementos argumentativos*
    baseados no método científico. Descreva-os sinteticamente dentro do
    contexto do artigo de base, usando frases bem curtas. Anote essas
    descrições nas caixas de texto abaixo:

### Problema

Qual problema científico os autores se propuseram a resolver nesse
estudo?

```{=html}
<style>
.answer-box {
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
```

::: answer-box
Escreva sua resposta aqui.
:::

### Hipótese

Qual ideia sobre o funcionamento da natureza os autores pretendiam
testar nesse estudo?

```{=html}
<style>
.answer-box {
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
```

::: answer-box
Escreva sua resposta aqui.
:::

## Operacionalização

Quais variáveis operacionais foram definidas para análise?

```{=html}
<style>
.answer-box {
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
```

::: answer-box
Escreva sua resposta aqui.
:::

Como os autores esperavam que essas variáveis operacionais afetassem
umas às outras? Ou seja, quais foram as previsões testadas
concretamente?

```{=html}
<style>
.answer-box {
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
```

::: answer-box
Escreva sua resposta aqui.
:::

## Teste das previsões

Antes de analisarmos os dados, que tal assistir aos **vídeos do
experimento** com os
[besouros](https://en.m.wikipedia.org/wiki/Gnatocerus_cornutus),
disponibilizados no suplemento do artigo? Eles estão disponíveis no
subdiretório `dados`.

Agora vamos testar as previsões do estudo visualmente, reproduzindo os
gráficos apresentados na **Figura 2** do artigo de base. Não se preocupe
com os detalhes sobre as análises numéricas.

### Figura 2a

Começando pela **Figura 2a**, ela represente um tipo de gráfico muito
usado, conhecido como **diagrama de dispersão de pontos**, que serve
para ilustrar a relação entre duas variáveis contínuas nos eixos X e Y.

Felizmente, os autores do artigo de base incluíram um suplemento, com os
dados usados anas análises e também vídeos dos experimentos. Você pode
conferir os dados e metadados no arquivo `dados.xlsx`, que está
disponível aqui no repositório. Criamos ainda uma versão simplificada,
`dados.csv`, que usaremos diretamente nos códigos a seguir.

Limpe os objetos criados anteriormente:

```{r}
rm(list= ls())
```

Informe para o R que o diretório de trabalho é o mesmo onde se encontra
este tutorial:

```{r}
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
```

De quais variáveis operacionais precisamos para reproduzir a Figura 2a?
Localize-se no arquivo `dados.xlsx`, disponível no subdiretório `dados`.

```{=html}
<style>
.answer-box {
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
```

::: answer-box
Escreva sua resposta aqui.
:::

Vamos reproduzir a Figura 2a, passo a passo.

Importe os dados para dentro de um objeto do R:

```{r}
dados <- read.csv("dados/dados.csv", header = T, sep = ";")

```

Inspecione os dados para ver se estão ok:

```{r}
head(dados)
```

Plote o gráfico com as mesmas variáveis usadas no artigo de base:

```{r}
ggplot(dados, aes(x = `Residual.mandible.length`, y = `Duration.of.thanatosis`)) +
  geom_point(color = "blue", alpha = 0.4) +
  labs(x = "residual mandible length (µm)", y = "duration of tonic immobility (log)",
       title = "Figura 2a") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5)) + 
  scale_x_continuous(breaks = seq(-200, 150, by = 50))
```

O gráfico ficou igual ao do artigo? Discuta com o seu grupo.

Discutiu? Então agora olhe o eixo Y.

Nota algo diferente? Pois é, os valores estão diferentes, não? Parece
que, na versão final da figura, esses dados foram transformados.

Transforme a variável Y pelo logaritmo, da mesma maneira como fizeram no
artigo de base:

```{r}
dados$Duration.of.thanatosis.log <- log10(dados$Duration.of.thanatosis)

```

Confira a variável transformada:

```{r}
head(dados)
```

Plote o o gráfico de novo, usando a variável transformada:

```{r}
ggplot(dados, aes(x = `Residual.mandible.length`, y = `Duration.of.thanatosis.log`)) +
  geom_point(color = "blue", alpha = 0.4) +
  labs(x = "residual mandible length (µm)", y = "duration of tonic immobility (log)",
       title = "Figura 2a") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5)) + 
  scale_x_continuous(breaks = seq(-200, 150, by = 50)) +
  scale_y_continuous(breaks = seq(0, 3, by = 0.5))


```

Agora o gráfico igual à Figura 2a do artigo de base? Discuta com o seu
grupo.

A previsão testada visualmente na Figura 2a se confirmou? Justifique a
sua resposta.

```{=html}
<style>
.answer-box {
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
```

::: answer-box
Escreva sua resposta aqui.
:::

### Figura 2b

Agora vamos reproduzir a **Figura 2b**. Ela representa um tipo especial
de diagrama de dispersão de pontos, conhecido como **diagrama
logístico**. Nesse tipo de gráfico, a variável X é contínua, enquanto a
variável Y assume apenas valores binários (0 ou 1).

Esse tipo de gráfico é ótimo para analisar visualmente relações do tipo
"sim ou não", "ganha ou perde", "acontece ou não acontece".

Infelizmente, os autores não incluíram no suplemento os dados exatos que
usaram para fazer essa figura. Logo, precisamos transformar a variável
que eles provavelmente usaram na análise.

Converta a variável contínua em binária, usando para isso um teste
lógico:

```{r}
dados$Duration.of.thanatosis.bin <- ifelse(dados$Duration.of.thanatosis == 0, 0, 1)

```

Confira a variável transformada:

```{r}
head(dados)
tail(dados)
```

Usando essa variável transformada, plote um gráfico igual ao da Figura
2b:

```{r}
ggplot(dados, aes(x=Residual.mandible.length, y=Duration.of.thanatosis.bin)) + 
  geom_point(colour = "#1855FA", size=2, alpha = 0.5) + 
  stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) +
  labs(x="residual mandible length (µm)", y = "frequency of tonic immobility",
       title = "Figura 2b") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5)) + 
  scale_x_continuous(breaks = seq(-200, 150, by = 50)) +
  scale_y_continuous(breaks = seq(0, 1, by = 1))
```

A previsão testada visualmente na Figura 2b se confirmou? Justifique a
sua resposta.

```{=html}
<style>
.answer-box {
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
```

::: answer-box
Escreva sua resposta aqui.
:::

## Conclusão

Você acha que as previsões do artigo de base foram confirmadas ou não?
Por que?

```{=html}
<style>
.answer-box {
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
```

::: answer-box
Escreva sua resposta aqui.
:::

## Passos finais

1.  Exporte este notebook com as suas respostas em formato HTML. Clique
    no botão `Knit`, que fica na barra de control deste arquivo RMD, e
    escolha `Knit to HTML`;

2.  Se não der certo, basta copiar e colar o seguinte código no
    `Console`:

    `rmarkdown::render("reproducao.Rmd", output_format = "html_document")`

3.  Carregue este notebook respondido no link do moodle para entrega do
    relatório.

## Para saber mais

1.  [Qual gráfico devo
    fazer?](https://marcoarmello.wordpress.com/2020/05/29/qualgrafico/)

2.  [Como escrever legendas de
    figuras](https://marcoarmello.wordpress.com/2018/03/28/legendas/)

3.  [Como fazer figuras para artigos
    científicos](https://marcoarmello.wordpress.com/2012/03/13/figuras/)
